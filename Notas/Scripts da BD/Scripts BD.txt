create database DBSoftkiami

create table Utilizador(
CodUtilizador int  identity (1,1) primary key,
Nome nvarchar(100) not null,
DataNasc datetime not null,
NIF nvarchar(100) unique not null,
Utiliza nvarchar(100) not null,
Senha nvarchar(100) not null,
Funcao  nvarchar(100) not null,
Email nvarchar(100) not null,
Genero nvarchar(100) not null,
EstadoCivil nvarchar(100) not null,
NumTel nvarchar(100) not null,
Provincia nvarchar(100) not null,
Municipio nvarchar(100) not null,
Bairro nvarchar(100) not null,
Rua nvarchar(100) not null,
DataRegist datetime not null
)

create table Funcionario(
CodFunc int  identity (1,1) primary key,
CodUtilizador int not null,
Nome nvarchar(100) not null,
DataNasc datetime not null,
NIF nvarchar(100) unique not null,
Funcao  nvarchar(100) not null,
Email nvarchar(100) not null,
Genero nvarchar(100) not null,
EstadoCivil nvarchar(100) not null,
NumTel nvarchar(100) not null,
Provincia nvarchar(100) not null,
Municipio nvarchar(100) not null,
Bairro nvarchar(100) not null,
Rua nvarchar(100) not null,
DataRegist datetime not null,
foreign key (CodUtilizador) references Utilizador
on update no action on delete cascade
)

create table Produto(
CodProdut int identity primary  key,
CodCateg int not null,
Designacao nvarchar(100) not null,
Qtd int not null,
IVA float not null,
PUnitario  money not null, 
Desconto float not null,
foreign key (CodCateg) references Categoria
)

create table Categoria(
CodCateg int identity primary key,
DesigCateg nvarchar(100) not null
)

create table Stock (
CodStock int identity primary key, 
CodProdut int not null, 
CodCateg int not null,
Qtd int not null,
DataFabrico date not null, 
DataExpiracao date not null, 
DataEntrega date not null, 
Origem nvarchar (50) not null,
foreign key (CodProdut) references Produto
on update no action on delete cascade,
foreign key (CodCateg) references Categoria
on update no action on delete cascade
)

create table Cliente (
CodCliente int identity primary key, 
Nome nvarchar (100) not null, 
NIF nvarchar (100) unique not null,
Email nvarchar (100) unique not null, 
NumTel nvarchar (100) not null, 
DataRegisto datetime not null,
)

create table Consulta (
CodConsul int identity(1,1) primary key, 
CodCliente int not null, 
NumeroConsul int unique not null, 
DataConsul datetime not null,
foreign key (CodCliente) references Cliente
on update no action on delete cascade
)

create table Venda (
CodVenda int identity primary key, 
CodUtilizador int not null, 
CodProdut int not null,
CodCliente int not null, 
Descrição nvarchar(100) not null,
Qtd int not null, 
TipoPGT nvarchar(100) not null,
DataVenda date not null,
PTotal money not null,
foreign key (CodUtilizador) references Utilizador,
foreign key (CodProdut) references Produto
on update no action on delete cascade,
foreign key (CodCliente) references Cliente
)

create table Fornecedor (
CodFornec int identity (1,1) primary key,
CodUtilizador int  not null,
CodProdut int not null,
Nome nvarchar (100) not null, 
DataNasc datetime not null,
NIF nvarchar (100) unique not null,  
Email nvarchar (100) unique not null,  
Genero nvarchar (100) not null, 
EstadoCivil nvarchar (100) not null, 
NumTel nvarchar (100) not null, 
Provincia nvarchar (100) not null,
Municipio nvarchar (100) not null, 
Bairro nvarchar (100) not null, 
Rua nvarchar (100) not null,
DataRegisto datetime not null,
foreign key (CodUtilizador ) references Utilizador ,
foreign key (CodProdut) references Produto
on update no action on delete cascade
)

create table Relatorio (
CodRelat int identity(1,1) primary key, 
CodUtilizador int not null, 
Título nvarchar(100) not null, 
DataRelat datetime not null,
foreign key (CodUtilizador) references Utilizador
on update cascade on delete cascade
)

create table TipoPGT(
CodTipo int identity primary key,
Nome nvarchar(100) not null
)

create procedure [dbo].[LoginUser]

@Utiliza nvarchar(100),
@Senha nvarchar(100)

as
begin

select * from utilizador where Utiliza = @Utiliza and Senha = @Senha

end

create procedure [dbo].[InserirProduto]

@Designacao nvarchar(100),
@Qtd int,
@IVA float,
@PUnitario money,
@Desconto float

as

begin

insert into produto values(@Designacao, @Qtd, @IVA, @PUnitario, @Desconto)
end

create procedure [dbo].[InserirUtilizador]

@Nome nvarchar(100),
@DataNasc datetime,
@NIF nvarchar(100),
@Utiliza nvarchar(100),
@Senha nvarchar(100),
@Funcao  nvarchar(100),
@Email nvarchar(100),
@Genero nvarchar(100),
@EstadoCivil nvarchar(100),
@NumTel nvarchar(100),
@Provincia nvarchar(100),
@Municipio nvarchar(100),
@Bairro nvarchar(100),
@Rua nvarchar(100),
@DataRegist datetime 

as
begin

insert into utilizador values 
(
@Nome,
@DataNasc,
@NIF,
@Utiliza,
@Senha,
@Funcao,
@Email,
@Genero,
@EstadoCivil,
@NumTel,
@Provincia,
@Municipio,
@Bairro,
@Rua,
@DataRegist
)
end

create procedure [dbo].[BuscarCodUtilizador]
@CodUtilizador int
as
begin

SELECT * FROM Utilizador WHERE CodUtilizador = @CodUtilizador
end 

create procedure [dbo].[EditarUtilizador]
@CodUtilizador int,
@Nome nvarchar(100), 
@DataNasc datetime,
@NIF nvarchar(100), 
@Utiliza nvarchar(100), 
@Senha nvarchar(100), 
@Funcao nvarchar(100),
@Email nvarchar(100),
@Genero nvarchar(100), 
@EstadoCivil nvarchar(100),
@NumTel nvarchar(100), 
@Provincia nvarchar(100),
@Municipio nvarchar(100), 
@Bairro nvarchar(100), 
@Rua nvarchar(100), 
@DataRegist datetime

as
begin

UPDATE Utilizador SET 
Nome = @Nome, DataNasc = @DataNasc, NIF = @NIF, 
Utiliza = @Utiliza, Senha = @Senha, Funcao = @Funcao,
Email = @Email, Genero = @Genero, EstadoCivil = @EstadoCivil,
NumTel = @NumTel, Provincia = @Provincia,
Municipio =  @Municipio, 
Bairro = @Bairro, Rua = @Rua, DataRegist = @DataRegist 

WHERE CodUtilizador =  @CodUtilizador

end 

create procedure [dbo].[ConsultarUtilizador]

@Nome nvarchar(100),
@NIF nvarchar(100),
@Funcao nvarchar(100)

as
begin

SELECT CodUtilizador, Nome, 
Email, NIF, Funcao 
FROM Utilizador  
WHERE Nome like @Nome 
or NIF like @NIF 
or Funcao like @Funcao
end

create procedure [dbo].[EliminarUtilizador]

@CodUtilizador int
as
begin

DELETE FROM Utilizador WHERE CodUtilizador = @CodUtilizador
end

create proc [dbo].[InserirCliente]

@Nome nvarchar (100),
@DataNasc datetime, 
@NIF nvarchar (100),
@Email nvarchar (100), 
@Genero nvarchar (100), 
@EstadoCivil nvarchar, 
@NumTel nvarchar (100), 
@Provincia nvarchar(100), 
@Municipio nvarchar(100), 
@Bairro nvarchar(100), 
@Rua nvarchar (100),
@DataRegist datetime

as
begin

insert into cliente 
values
(@Nome,
@DataNasc, 
@NIF,
@Email, 
@Genero, 
@EstadoCivil, 
@NumTel, 
@Provincia, 
@Municipio, 
@Bairro, 
@Rua,
@DataRegist)

end

create procedure [dbo].[ConsultarCliente]

@Nome nvarchar(100),
@NIF nvarchar(100),
@Email nvarchar(100),
@NumTel nvarchar(100)

as
begin

SELECT CodCliente, Nome, NIF,Email, NumTel
FROM Cliente  WHERE
Nome like @Nome or NIF like @NIF or Email like @Email or NumTel like @NumTel
end

create proc [dbo].[BuscarCodCliente]
@CodCliente int

as
begin

select * from cliente where CodCliente = @codcliente

end

create procedure [dbo].[EditarCliente]
@CodCliente int,
@DataNasc datetime,
@Nome nvarchar(100),
@NIF nvarchar(100),
@Email nvarchar(100),
@Genero nvarchar(100),
@EstadoCivil nvarchar(100),
@NumTel nvarchar(100),
@Provincia nvarchar(100),
@Municipio nvarchar(100),
@Bairro nvarchar(100),
@Rua nvarchar(100),
@DataRegist datetime

as
begin

update Cliente set
DataNasc = @DataNasc,
Nome = @Nome,
NIF = @NIF,
Email = @Email,
Genero = @Genero,
EstadoCivil = @EstadoCivil,
NumTel = @NumTel,
Provincia = @Provincia,
Municipio = @Municipio,
Bairro = @Bairro,
Rua = @Rua,
DataRegist = @DataRegist

WHERE codCliente = @Codcliente

end

create proc [dbo].[EliminarCliente]

@CodCliente int
as
begin

delete from cliente 
where codcliente = @codcliente
end

create proc [dbo].[InserirFornecedor]

@Nome nvarchar(100),
@DataNasc datetime,
@NIF nvarchar(100),
@Email nvarchar(100),
@Genero nvarchar(100),
@EstadoCivil nvarchar(100),
@NumTel nvarchar(100),
@Provincia nvarchar(100),
@Municipio nvarchar(100),
@Bairro nvarchar(100),
@Rua nvarchar(100),
@DataRegist datetime
as
begin

insert into fornecedor values(
@Nome,
@DataNasc,
@NIF,
@Email,
@Genero,
@EstadoCivil,
@NumTel,
@Provincia,
@Municipio,
@Bairro,
@Rua,
@DataRegist
)
end

create  procedure [dbo].[ConsultarFornecedor]

@Nome nvarchar(100),
@NIF nvarchar(100),
@Email nvarchar(100),
@NumTel nvarchar(100)

as
begin

SELECT CodFornec, Nome, NIF,Email, NumTel
FROM fornecedor  WHERE
Nome like @Nome or NIF like @NIF or Email like @Email or NumTel like @NumTel
end

create proc [dbo].[BuscarCodFornecedor]

@CodFornec int

as
begin
select * from fornecedor
where CodFornec = @CodFornec
end

create procedure [dbo].[EditarFornecedor]
@CodFornec int,
@DataNasc datetime,
@Nome nvarchar(100),
@NIF nvarchar(100),
@Email nvarchar(100),
@Genero nvarchar(100),
@EstadoCivil nvarchar(100),
@NumTel nvarchar(100),
@Provincia nvarchar(100),
@Municipio nvarchar(100),
@Bairro nvarchar(100),
@Rua nvarchar(100),
@DataRegist datetime

as
begin

update fornecedor set
DataNasc = @DataNasc,
Nome = @Nome,
NIF = @NIF,
Email = @Email,
Genero = @Genero,
EstadoCivil = @EstadoCivil,
NumTel = @NumTel,
Provincia = @Provincia,
Municipio = @Municipio,
Bairro = @Bairro,
Rua = @Rua,
DataRegist = @DataRegist

WHERE CodFornec = @CodFornec

end

create procedure [dbo].[EliminarFornecedor]
@CodFornec int


as
begin

delete from fornecedor

WHERE CodFornec = @CodFornec

end

create proc [dbo].[ConsultarCategoria]
as
begin
select * from categoria order by desigcateg asc
end

create proc [dbo].[InserirFuncionario]
--@CodUtilizador int,
@Nome nvarchar(100),
@DataNasc datetime,
@NIF nvarchar(100),
@Funcao nvarchar(100),
@Email nvarchar(100),
@Genero nvarchar(100),
@EstadoCivil nvarchar(100),
@NumTel nvarchar(100),
@Provincia nvarchar(100),
@Municipio nvarchar(100),
@Bairro nvarchar(100),
@Rua nvarchar(100),
@DataRegist datetime
as
begin
insert into Funcionario values
(
--@CodUtilizador,
@Nome,
@DataNasc,
@NIF,
@Funcao,
@Email,
@Genero,
@EstadoCivil,
@NumTel,
@Provincia,
@Municipio,
@Bairro,
@Rua,
@DataRegist
)
end

create proc [dbo].[ConsultarProduto]
as
begin
select codprodut as codigo, designacao, qtd, iva, punitario, desconto, desigcateg
from produto
inner join categoria on produto.codcateg=categoria.codcateg
end

insert into Utilizador(nome, datanasc, nif, utiliza, senha, funcao, email,
genero, estadocivil, numtel, provincia, municipio, bairro, rua, dataregist)
values('Fernandes Clemente', '20240505 00:00:00','6546544444984', 'Fernandes', 'papa11', 
'Administrador', 'fernandes@fernandes.com', 'mascúlino', 'solteiro', '95445', 'Luanda','Viana', 'Zango', '4','20240505')

insert into cliente(codfunc, nome, datanasc, nif, email,
genero, estadocivil, numtel, provincia, municipio, bairro, rua, dataregisto)
values(2, 'Daniel Bula', '20240505 00:00:00','6546544444984', 'daniel@bula.com', 'mascúlino', 'solteiro', '95445', 'Luanda','Viana', 'Zango', '4','20240505 00:00:00')


insert into produto (codfunc, qtd, iva, punitario, desconto)
values(1, 3, 14, 650, 0)

insert into categoria values
(''),
('Lâmina/s'),
('Ampola/s'),
('Frasco/s'),
('Seringa/s'),
('Gota/s'),
('Sabote'),
('Pomada/s'),
('Outro/s')

insert into TipoPGT values
(''),
('TPA'),
('Cheque'),
('Transferência'),
('Depósito'),
('Cash')

insert into fornecedor values(

'Fernandes Clemente',
'20240516 00:00:00',
'500454445',
'fernandes@gmail.com',
'Mascúlino',
'Solteiro',
'955454',
'Luanda',
'Viana',
'Zango',
'4',
'20240516 00:00:00'
)

select codprodut as codigo, designacao, qtd, iva, punitario, desconto, desigcateg
from produto
inner join categoria on produto.codcateg=categoria.codcateg
